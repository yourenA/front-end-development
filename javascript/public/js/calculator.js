'use strict';

/**
 * Created by Administrator on 2017/10/31.
 */
var oinput = document.getElementsByTagName('input')[0];
//获取外部样式
function getStyle(obj, name) {
    if (obj.currentStyle) {
        return obj.currentStyle[name];
    } else {
        return getComputedStyle(obj, false)[name];
    }
}
//渐变动画
function move(obj, attr, tar) {
    clearInterval(obj.timer);
    obj.timer = setInterval(function () {
        var cur = parseInt(getStyle(obj, attr));
        var itarget = parseInt(tar);
        var speed = (itarget - cur) / 6;
        speed = speed > 0 ? Math.ceil(speed) : Math.floor(speed);
        obj.style[attr] = parseInt(getStyle(obj, attr)) + speed + 'px';
        if (speed == 0) {
            clearInterval(obj.timer);
        }
    }, 30);
}
//事件绑定函数
function addEvent(obj, ev, fun) {
    if (obj.attachEvent) {
        obj.attachEvent('on' + ev, fun);
    } else {
        obj.addEventListener(ev, fun, false);
    }
}
//阻止默认行为
function stopEvent(ev) {
    var e = ev || window.event;
    if (e.preventDefault) {
        e.preventDefault();
    } else {
        e.returnValue = false; //ie
    }
}
//计算最终结果
function getResult() {
    function evalResult() {
        var result = parseFloat(eval(oinput.value).toFixed(10));
        return result;
    }
    //捕获异常
    try {
        var x = evalResult();
        return x;
    } catch (e) {
        oinput.className = 'showError';
        var errorHint = document.getElementById('errorHint');
        move(errorHint, 'top', 0);
        setTimeout(function () {
            oinput.className = '';
            move(errorHint, 'top', -282);
        }, 2000);
        return oinput.value;
    }
}
//文本框获取焦点，错误提示消失
//按下回车得到结果
function enterResult(ev) {
    var e = ev || window.event;
    var obtns = document.getElementsByTagName('button');
    stopEvent(e);
    console.log(e.keyCode);
    for (var i = 0; i < obtns.length; i++) {
        if (obtns[i].innerHTML == e.key) {
            obtns[i].style.borderColor = 'white';
            if (e.key === 'Backspace') {
                oinput.value = oinput.value.toString().slice(0, -1);
            }
        } else {
            obtns[i].style.borderColor = '#000';
        }
    }
    if (e.keyCode == 13 || e.keyCode == 108) {
        // stopEvent(ev);//阻止enter键的默认行为
        var result = getResult();
        oinput.value = result;
    } else if (e.keyCode == 48 || e.keyCode == 49 || e.keyCode == 50 || e.keyCode == 51 || e.keyCode == 52 || e.keyCode == 53 || e.keyCode == 54 || e.keyCode == 55 || e.keyCode == 56 || e.keyCode == 57 || e.keyCode == 96 || e.keyCode == 97 || e.keyCode == 98 || e.keyCode == 99 || e.keyCode == 100 || e.keyCode == 101 || e.keyCode == 102 || e.keyCode == 103 || e.keyCode == 104 || e.keyCode == 105 || e.keyCode == 106 || e.keyCode == 107 || e.keyCode == 109 || e.keyCode == 110 || e.keyCode == 111 || e.keyCode == 190) {
        if (oinput.value == '0') {
            oinput.value = '';
        }
        oinput.value += e.key;
    }
}
//绑定点击事件
function init() {
    var otable = document.getElementsByTagName('table')[0];
    addEvent(document, 'keydown', function (ev) {
        enterResult(ev);
    });
    addEvent(otable, 'click', function (ev) {
        stopEvent(ev);
        var e = ev || window.event;
        var itat = e.target || e.srcElement;
        var obtns = document.getElementsByTagName('button');
        if (itat.nodeName.toLowerCase() == 'button') {
            for (var i = 0; i < obtns.length; i++) {
                obtns[i].style.borderColor = '#000';
            }
            itat.style.borderColor = 'white';
            if (itat.className != 'setChange') {
                if (oinput.value == '0') {
                    oinput.value = '';
                    oinput.value += itat.innerHTML;
                } else {
                    oinput.value += itat.innerHTML;
                }
            } else {
                if (itat.id == 'backSpace') {
                    oinput.value = oinput.value.toString().slice(0, -1);
                } else if (itat.id == 'clearNum') {
                    oinput.value = '0';
                } else {
                    var result = getResult();
                    oinput.value = result;
                }
            }
        }
    });
}
init();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbGN1bGF0b3IuanMiXSwibmFtZXMiOlsib2lucHV0IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImdldFN0eWxlIiwib2JqIiwibmFtZSIsImN1cnJlbnRTdHlsZSIsImdldENvbXB1dGVkU3R5bGUiLCJtb3ZlIiwiYXR0ciIsInRhciIsImNsZWFySW50ZXJ2YWwiLCJ0aW1lciIsInNldEludGVydmFsIiwiY3VyIiwicGFyc2VJbnQiLCJpdGFyZ2V0Iiwic3BlZWQiLCJNYXRoIiwiY2VpbCIsImZsb29yIiwic3R5bGUiLCJhZGRFdmVudCIsImV2IiwiZnVuIiwiYXR0YWNoRXZlbnQiLCJhZGRFdmVudExpc3RlbmVyIiwic3RvcEV2ZW50IiwiZSIsIndpbmRvdyIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJyZXR1cm5WYWx1ZSIsImdldFJlc3VsdCIsImV2YWxSZXN1bHQiLCJyZXN1bHQiLCJwYXJzZUZsb2F0IiwiZXZhbCIsInZhbHVlIiwidG9GaXhlZCIsIngiLCJjbGFzc05hbWUiLCJlcnJvckhpbnQiLCJnZXRFbGVtZW50QnlJZCIsInNldFRpbWVvdXQiLCJlbnRlclJlc3VsdCIsIm9idG5zIiwiY29uc29sZSIsImxvZyIsImtleUNvZGUiLCJpIiwibGVuZ3RoIiwiaW5uZXJIVE1MIiwia2V5IiwiYm9yZGVyQ29sb3IiLCJ0b1N0cmluZyIsInNsaWNlIiwiaW5pdCIsIm90YWJsZSIsIml0YXQiLCJ0YXJnZXQiLCJzcmNFbGVtZW50Iiwibm9kZU5hbWUiLCJ0b0xvd2VyQ2FzZSIsImlkIl0sIm1hcHBpbmdzIjoiOztBQUFBOzs7QUFHQSxJQUFJQSxTQUFPQyxTQUFTQyxvQkFBVCxDQUE4QixPQUE5QixFQUF1QyxDQUF2QyxDQUFYO0FBQ0E7QUFDQSxTQUFTQyxRQUFULENBQWtCQyxHQUFsQixFQUF1QkMsSUFBdkIsRUFDQTtBQUNJLFFBQUdELElBQUlFLFlBQVAsRUFDQTtBQUNJLGVBQU9GLElBQUlFLFlBQUosQ0FBaUJELElB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TCxDQUFjQyxXQUFkLE1BQTZCLFFBQWhDLEVBQXlDO0FBQ3JDLGlCQUFJLElBQUliLElBQUUsQ0FBVixFQUFZQSxJQUFFSixNQUFNSyxNQUFwQixFQUEyQkQsR0FBM0IsRUFBK0I7QUFDM0JKLHNCQUFNSSxDQUFOLEVBQVM3QixLQUFULENBQWVpQyxXQUFmLEdBQTJCLE1BQTNCO0FBQ0g7QUFDREssaUJBQUt0QyxLQUFMLENBQVdpQyxXQUFYLEdBQXVCLE9BQXZCO0FBQ0EsZ0JBQUdLLEtBQUtsQixTQUFMLElBQWdCLFdBQW5CLEVBQStCO0FBQzNCLG9CQUFHekMsT0FBT3NDLEtBQVAsSUFBYyxHQUFqQixFQUFxQjtBQUNqQnRDLDJCQUFPc0MsS0FBUCxHQUFhLEVBQWI7QUFDQXRDLDJCQUFPc0MsS0FBUCxJQUFjcUIsS0FBS1AsU0FBbkI7QUFDSCxpQkFIRCxNQUlJO0FBQ0FwRCwyQkFBT3NDLEtBQVAsSUFBY3FCLEtBQUtQLFNBQW5CO0FBQ0g7QUFDSixhQVJELE1BUUs7QUFDRCxvQkFBR08sS0FBS0ssRUFBTCxJQUFTLFdBQVosRUFBd0I7QUFDcEJoRSwyQkFBT3NDLEtBQVAsR0FBYXRDLE9BQU9zQyxLQUFQLENBQWFpQixRQUFiLEdBQXdCQyxLQUF4QixDQUE4QixDQUE5QixFQUFnQyxDQUFDLENBQWpDLENBQWI7QUFDSCxpQkFGRCxNQUdLLElBQUdHLEtBQUtLLEVBQUwsSUFBUyxVQUFaLEVBQXVCO0FBQ3hCaEUsMkJBQU9zQyxLQUFQLEdBQWEsR0FBYjtBQUNILGlCQUZJLE1BRUE7QUFDRCx3QkFBSUgsU0FBT0YsV0FBWDtBQUNBakMsMkJBQU9zQyxLQUFQLEdBQWFILE1BQWI7QUFDSDtBQUNKO0FBQ0o7QUFDSixLQTlCRDtBQStCSDtBQUNEc0IiLCJmaWxlIjoiY2FsY3VsYXRvci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IEFkbWluaXN0cmF0b3Igb24gMjAxNy8xMC8zMS5cclxuICovXHJcbnZhciBvaW5wdXQ9ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2lucHV0JylbMF07XHJcbi8v6I635Y+W5aSW6YOo5qC35byPXHJcbmZ1bmN0aW9uIGdldFN0eWxlKG9iaiwgbmFtZSlcclxue1xyXG4gICAgaWYob2JqLmN1cnJlbnRTdHlsZSlcclxuICAgIHtcclxuICAgICAgICByZXR1cm4gb2JqLmN1cnJlbnRTdHlsZVtuYW1lXTtcclxuICAgIH1cclxuICAgIGVsc2VcclxuICAgIHtcclxuICAgICAgICByZXR1cm4gZ2V0Q29tcHV0ZWRTdHlsZShvYmosIGZhbHNlKVtuYW1lXTtcclxuICAgIH1cclxufVxyXG4vL+a4kOWPmOWKqOeUu1xyXG5mdW5jdGlvbiBtb3ZlKG9iaixhdHRyLHRhcil7XHJcbiAgICBjbGVhckludGVydmFsKG9iai50aW1lcik7XHJcbiAgICBvYmoudGltZXI9c2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgY3VyPXBhcnNlSW50KGdldFN0eWxlKG9iaixhdHRyKSk7XHJcbiAgICAgICAgdmFyIGl0YXJnZXQ9cGFyc2VJbnQodGFyKTtcclxuICAgICAgICB2YXIgc3BlZWQ9KGl0YXJnZXQtY3VyKS82O1xyXG4gICAgICAgIHNwZWVkPXNwZWVkPjA/TWF0aC5jZWlsKHNwZWVkKTpNYXRoLmZsb29yKHNwZWVkKTtcclxuICAgICAgICBvYmouc3R5bGVbYXR0cl09cGFyc2VJbnQoZ2V0U3R5bGUob2JqLGF0dHIpKStzcGVlZCsncHgnO1xyXG4gICAgICAgIGlmKHNwZWVkPT0wKXtcclxuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChvYmoudGltZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH0sMzApO1xyXG59XHJcbi8v5LqL5Lu257uR5a6a5Ye95pWwXHJcbmZ1bmN0aW9uIGFkZEV2ZW50KG9iaixldixmdW4pe1xyXG4gICAgaWYob2JqLmF0dGFjaEV2ZW50KXtcclxuICAgICAgICBvYmouYXR0YWNoRXZlbnQoJ29uJytldixmdW4pO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgb2JqLmFkZEV2ZW50TGlzdGVuZXIoZXYsZnVuLGZhbHNlKTtcclxuICAgIH1cclxufVxyXG4vL+mYu+atoum7mOiupOihjOS4ulxyXG5mdW5jdGlvbiBzdG9wRXZlbnQoZXYpe1xyXG4gICAgdmFyIGU9ZXZ8fHdpbmRvdy5ldmVudDtcclxuICAgIGlmKGUucHJldmVudERlZmF1bHQpe1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIH1cclxuICAgIGVsc2V7XHJcbiAgICAgICAgZS5yZXR1cm5WYWx1ZT1mYWxzZTsvL2llXHJcbiAgICB9XHJcbn1cclxuLy/orqHnrpfmnIDnu4jnu5PmnpxcclxuZnVuY3Rpb24gZ2V0UmVzdWx0KCl7XHJcbiAgICBmdW5jdGlvbiBldmFsUmVzdWx0KCl7XHJcbiAgICAgICAgdmFyIHJlc3VsdD1wYXJzZUZsb2F0KChldmFsKG9pbnB1dC52YWx1ZSkpLnRvRml4ZWQoMTApKTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG4gICAgLy/mjZXojrflvILluLhcclxuICAgIHRyeXtcclxuICAgICAgICB2YXIgeD1ldmFsUmVzdWx0KCk7XHJcbiAgICAgICAgcmV0dXJuIHg7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSl7XHJcbiAgICAgICAgb2lucHV0LmNsYXNzTmFtZT0nc2hvd0Vycm9yJztcclxuICAgICAgICB2YXIgZXJyb3JIaW50PWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvckhpbnQnKTtcclxuICAgICAgICBtb3ZlKGVycm9ySGludCwndG9wJywwKTtcclxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIG9pbnB1dC5jbGFzc05hbWU9Jyc7XHJcbiAgICAgICAgICAgIG1vdmUoZXJyb3JIaW50LCd0b3AnLC0yODIpO1xyXG4gICAgICAgIH0sMjAwMCk7XHJcbiAgICAgICAgcmV0dXJuIG9pbnB1dC52YWx1ZTtcclxuICAgIH1cclxufVxyXG4vL+aWh+acrOahhuiOt+WPlueEpueCue+8jOmUmeivr+aPkOekuua2iOWksVxyXG4vL+aMieS4i+Wbnui9puW+l+WIsOe7k+aenFxyXG5mdW5jdGlvbiBlbnRlclJlc3VsdChldil7XHJcbiAgICB2YXIgZT1ldnx8d2luZG93LmV2ZW50O1xyXG4gICAgdmFyIG9idG5zPWRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdidXR0b24nKTtcclxuICAgIHN0b3BFdmVudChlKVxyXG4gICAgY29uc29sZS5sb2coZS5rZXlDb2RlKVxyXG4gICAgZm9yKHZhciBpPTA7aTxvYnRucy5sZW5ndGg7aSsrKXtcclxuICAgICAgICBpZihvYnRuc1tpXS5pbm5lckhUTUw9PWUua2V5ICl7XHJcbiAgICAgICAgICAgIG9idG5zW2ldLnN0eWxlLmJvcmRlckNvbG9yPSd3aGl0ZSc7XHJcbiAgICAgICAgICAgIGlmKGUua2V5PT09J0JhY2tzcGFjZScpe1xyXG4gICAgICAgICAgICAgICAgb2lucHV0LnZhbHVlPW9pbnB1dC52YWx1ZS50b1N0cmluZygpLnNsaWNlKDAsLTEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIG9idG5zW2ldLnN0eWxlLmJvcmRlckNvbG9yPScjMDAwJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZihlLmtleUNvZGU9PTEzfHxlLmtleUNvZGU9PTEwOCl7XHJcbiAgICAgICAgLy8gc3RvcEV2ZW50KGV2KTsvL+mYu+atomVudGVy6ZSu55qE6buY6K6k6KGM5Li6XHJcbiAgICAgICAgdmFyIHJlc3VsdD1nZXRSZXN1bHQoKTtcclxuICAgICAgICBvaW5wdXQudmFsdWU9cmVzdWx0O1xyXG4gICAgfWVsc2UgaWYoZS5rZXlDb2RlPT00OHx8ZS5rZXlDb2RlPT00OXx8ZS5rZXlDb2RlPT01MHx8ZS5rZXlDb2RlPT01MXx8ZS5rZXlDb2RlPT01Mnx8ZS5rZXlDb2RlPT01M3x8ZS5rZXlDb2RlPT01NHx8XHJcbiAgICAgICAgZS5rZXlDb2RlPT01NXx8ZS5rZXlDb2RlPT01Nnx8ZS5rZXlDb2RlPT01N3x8ZS5rZXlDb2RlPT05Nnx8ZS5rZXlDb2RlPT05N3x8ZS5rZXlDb2RlPT05OHx8ZS5rZXlDb2RlPT05OXx8ZS5rZXlDb2RlPT0xMDB8fFxyXG4gICAgICAgIGUua2V5Q29kZT09MTAxfHxlLmtleUNvZGU9PTEwMnx8ZS5rZXlDb2RlPT0xMDN8fGUua2V5Q29kZT09MTA0fHxlLmtleUNvZGU9PTEwNXx8ZS5rZXlDb2RlPT0xMDZ8fFxyXG4gICAgICAgIGUua2V5Q29kZT09MTA3fHxlLmtleUNvZGU9PTEwOXx8ZS5rZXlDb2RlPT0xMTB8fGUua2V5Q29kZT09MTExfHxlLmtleUNvZGU9PTE5MCl7XHJcbiAgICAgICAgaWYoIG9pbnB1dC52YWx1ZT09JzAnKXtcclxuICAgICAgICAgICAgb2lucHV0LnZhbHVlPScnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvaW5wdXQudmFsdWUrPWUua2V5O1xyXG4gICAgfVxyXG59XHJcbi8v57uR5a6a54K55Ye75LqL5Lu2XHJcbmZ1bmN0aW9uIGluaXQoKXtcclxuICAgIHZhciBvdGFibGU9ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RhYmxlJylbMF07XHJcbiAgICBhZGRFdmVudChkb2N1bWVudCwna2V5ZG93bicsZnVuY3Rpb24oZXYpe1xyXG4gICAgICAgIGVudGVyUmVzdWx0KGV2KTtcclxuICAgIH0pO1xyXG4gICAgYWRkRXZlbnQob3RhYmxlLCdjbGljaycsZnVuY3Rpb24oZXYpe1xyXG4gICAgICAgIHN0b3BFdmVudChldik7XHJcbiAgICAgICAgdmFyIGU9ZXZ8fHdpbmRvdy5ldmVudDtcclxuICAgICAgICB2YXIgaXRhdD1lLnRhcmdldHx8ZS5zcmNFbGVtZW50O1xyXG4gICAgICAgIHZhciBvYnRucz1kb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYnV0dG9uJyk7XHJcbiAgICAgICAgaWYoaXRhdC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT0nYnV0dG9uJyl7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaT0wO2k8b2J0bnMubGVuZ3RoO2krKyl7XHJcbiAgICAgICAgICAgICAgICBvYnRuc1tpXS5zdHlsZS5ib3JkZXJDb2xvcj0nIzAwMCc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaXRhdC5zdHlsZS5ib3JkZXJDb2xvcj0nd2hpdGUnO1xyXG4gICAgICAgICAgICBpZihpdGF0LmNsYXNzTmFtZSE9J3NldENoYW5nZScpe1xyXG4gICAgICAgICAgICAgICAgaWYob2lucHV0LnZhbHVlPT0nMCcpe1xyXG4gICAgICAgICAgICAgICAgICAgIG9pbnB1dC52YWx1ZT0nJztcclxuICAgICAgICAgICAgICAgICAgICBvaW5wdXQudmFsdWUrPWl0YXQuaW5uZXJIVE1MO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBvaW5wdXQudmFsdWUrPWl0YXQuaW5uZXJIVE1MO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIGlmKGl0YXQuaWQ9PSdiYWNrU3BhY2UnKXtcclxuICAgICAgICAgICAgICAgICAgICBvaW5wdXQudmFsdWU9b2lucHV0LnZhbHVlLnRvU3RyaW5nKCkuc2xpY2UoMCwtMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmKGl0YXQuaWQ9PSdjbGVhck51bScpe1xyXG4gICAgICAgICAgICAgICAgICAgIG9pbnB1dC52YWx1ZT0nMCc7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0PWdldFJlc3VsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIG9pbnB1dC52YWx1ZT1yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5pbml0KCk7Il19
